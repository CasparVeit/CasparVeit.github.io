<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini Minecraft 2D</title>
<style>
body{margin:0;overflow:hidden;background:#87ceeb}
canvas{display:block}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
/* ================= BASIS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 900;
canvas.height = 450;

const TILE = 40;
const ROWS = 12;

/* Block IDs
0 Luft | 1 Erde | 2 Stein | 3 Holz | 9 Haus
*/

let world = [];
let cameraX = 0;

/* ================= WELT ================= */
function generateColumn(x){
  let col=[];
  for(let y=0;y<ROWS;y++){
    if(y<5) col.push(0);
    else if(y===5) col.push(1);
    else col.push(2);
  }

  // Baum
  if(Math.random()<0.08){
    col[4]=3;
    col[3]=3;
  }

  // Dorf-HÃ¤user
  if(x%50===0){
    col[5]=9;
    col[4]=9;
    col[3]=9;
  }

  return col;
}

for(let i=0;i<80;i++) world.push(generateColumn(i));

function extendWorld(){
  if(cameraX/TILE + 30 > world.length){
    for(let i=0;i<20;i++) world.push(generateColumn(world.length+i));
  }
}

/* ================= SPIELER ================= */
const player={
  x:200,y:0,w:30,h:30,
  vy:0,onGround:false,
  hp:10,hunger:10
};

/* ================= ENTITIES ================= */
let monsters=[];
let animals=[];
let villagers=[];

/* ================= STEUERUNG ================= */
const keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

/* ================= PHYSIK ================= */
function solidAt(x,y){
  const bx=Math.floor(x/TILE);
  const by=Math.floor(y/TILE);
  return world[bx]?.[by]>0;
}

function applyPhysics(o){
  o.vy+=0.5;
  o.y+=o.vy;
  const fy=Math.floor((o.y+o.h)/TILE);
  const fx=Math.floor(o.x/TILE);
  if(world[fx]?.[fy]>0){
    o.y=fy*TILE-o.h;
    o.vy=0;
    o.onGround=true;
  } else o.onGround=false;
}

/* ================= SPIELER ================= */
function updatePlayer(){
  if(keys["a"]) player.x-=4;
  if(keys["d"]) player.x+=4;
  if(keys["w"] && player.onGround) player.vy=-10;
  applyPhysics(player);

  cameraX=player.x-canvas.width/2;
  if(cameraX<0) cameraX=0;
}

/* ================= TAG / NACHT ================= */
let time=0;
function updateTime(){
  time+=0.0002; // SEHR LANGSAM
  if(time>1) time=0;
}

/* ================= MONSTER ================= */
function spawnMonsters(){
  if(time>0.5 && Math.random()<0.01){
    monsters.push({x:player.x+600,y:0,w:30,h:30,vy:0});
  }
}
function updateMonsters(){
  monsters.forEach(m=>{
    m.x+=(player.x>m.x?1:-1)*1.2;
    applyPhysics(m);
  });
}

/* ================= TIERE ================= */
function spawnAnimals(){
  if(time<0.5 && Math.random()<0.01){
    animals.push({x:player.x+400,y:0,w:30,h:30,vy:0});
  }
}
function updateAnimals(){
  animals.forEach(a=>{
    if(Math.random()<0.02) a.x+=Math.random()<0.5?-1:1;
    applyPhysics(a);
  });
}

/* ================= DORFBEWOHNER ================= */
function spawnVillagers(){
  if(Math.random()<0.005){
    villagers.push({x:player.x+500,y:0,w:30,h:30,vy:0});
  }
}
function updateVillagers(){
  villagers.forEach(v=>{
    if(Math.random()<0.01) v.x+=Math.random()<0.5?-1:1;
    applyPhysics(v);
  });
}

/* ================= HERZEN & HUNGER ================= */
function drawHearts(){
  for(let i=0;i<player.hp;i++){
    ctx.fillStyle="red";
    ctx.fillRect(player.x-cameraX+i*8,player.y-15,6,6);
  }
}
function drawHunger(){
  for(let i=0;i<player.hunger;i++){
    ctx.fillStyle="orange";
    ctx.fillRect(player.x-cameraX+i*8,player.y-5,6,6);
  }
}

/* ================= ZEICHNEN ================= */
function draw(){
  ctx.fillStyle=`rgb(${135*(1-time)},${206*(1-time)},${235*(1-time)})`;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let x=0;x<world.length;x++){
    for(let y=0;y<ROWS;y++){
      const b=world[x][y];
      if(!b) continue;
      const c={1:"#654321",2:"#888",3:"#deb887",9:"#a0522d"};
      ctx.fillStyle=c[b];
      ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE);
    }
  }

  ctx.fillStyle="red";
  ctx.fillRect(player.x-cameraX,player.y,player.w,player.h);

  ctx.fillStyle="green";
  monsters.forEach(m=>ctx.fillRect(m.x-cameraX,m.y,m.w,m.h));

  ctx.fillStyle="brown";
  animals.forEach(a=>ctx.fillRect(a.x-cameraX,a.y,a.w,a.h));

  ctx.fillStyle="#ffdead";
  villagers.forEach(v=>ctx.fillRect(v.x-cameraX,v.y,v.w,v.h));

  drawHearts();
  drawHunger();
}

/* ================= LOOP ================= */
function loop(){
  updateTime();
  extendWorld();
  updatePlayer();
  spawnMonsters();
  spawnAnimals();
  spawnVillagers();
  updateMonsters();
  updateAnimals();
  updateVillagers();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
