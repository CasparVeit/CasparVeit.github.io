<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini Minecraft 2D</title>
<style>
body{margin:0;overflow:hidden;background:#87ceeb}
canvas{display:block}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
/* ================= BASIS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 900;
canvas.height = 450;

const TILE = 40;
const ROWS = 12;

/* Block-IDs
0 Luft | 1 Erde | 2 Stein | 3 Holz | 4 Werkbank
5 Eisen | 6 Gold | 7 Diamant | 8 Wasser
*/

let world = [];
let cameraX = 0;

/* ================= WELT ================= */
function generateColumn(){
  let col=[];
  for(let y=0;y<ROWS;y++){
    if(y<5) col.push(0);
    else if(y===5) col.push(1);
    else{
      let r=Math.random();
      if(r<0.02) col.push(7);
      else if(r<0.07) col.push(6);
      else if(r<0.2) col.push(5);
      else col.push(2);
    }
  }
  if(Math.random()<0.1){ col[4]=3; col[3]=3; }
  return col;
}
for(let i=0;i<60;i++) world.push(generateColumn());
function extendWorld(){
  if(cameraX/TILE + 30 > world.length){
    for(let i=0;i<10;i++) world.push(generateColumn());
  }
}

/* ================= SPIELER ================= */
const player={
  x:200,y:0,w:30,h:30,
  vy:0,onGround:false,
  hp:10,hunger:10
};

/* ================= INVENTAR ================= */
let inventory={1:0,2:0,3:0,4:0,5:0,6:0,7:0};
let hotbar=[1,2,3,4,null,null,null,null,null];
let selectedSlot=0;

/* ================= MONSTER & TIERE ================= */
let monsters=[];
let animals=[];

/* ================= STEUERUNG ================= */
const keys={};
document.addEventListener("keydown",e=>{
  keys[e.key]=true;
  if(e.key>="1"&&e.key<="9") selectedSlot=Number(e.key)-1;
});
document.addEventListener("keyup",e=>keys[e.key]=false);

/* ================= PHYSIK ================= */
function solidAt(x,y){
  const bx=Math.floor(x/TILE);
  const by=Math.floor(y/TILE);
  return world[bx]?.[by]>0;
}

function applyPhysics(obj){
  obj.vy+=0.5;
  obj.y+=obj.vy;
  const footY=Math.floor((obj.y+obj.h)/TILE);
  const footX=Math.floor(obj.x/TILE);
  if(world[footX]?.[footY]>0){
    obj.y=footY*TILE-obj.h;
    obj.vy=0;
    obj.onGround=true;
  } else obj.onGround=false;
}

/* ================= SPIELER ================= */
function move(dx){
  if(!solidAt(player.x+dx,player.y) &&
     !solidAt(player.x+dx+player.w,player.y)){
    player.x+=dx;
  }
}
function updatePlayer(){
  if(keys["a"]) move(-4);
  if(keys["d"]) move(4);
  if(keys["w"]&&player.onGround) player.vy=-10;
  applyPhysics(player);
  cameraX=player.x-canvas.width/2;
  if(cameraX<0) cameraX=0;
}

/* ================= MAUS ================= */
canvas.addEventListener("mousedown",e=>{
  if(e.button!==0) return;
  const x=Math.floor((e.offsetX+cameraX)/TILE);
  const y=Math.floor(e.offsetY/TILE);
  const b=world[x]?.[y];
  if(b>0){
    inventory[b]++; world[x][y]=0;
  }
});
canvas.addEventListener("contextmenu",e=>{
  e.preventDefault();
  const x=Math.floor((e.offsetX+cameraX)/TILE);
  const y=Math.floor(e.offsetY/TILE);
  const item=hotbar[selectedSlot];
  if(item&&inventory[item]>0&&world[x][y]===0){
    world[x][y]=item; inventory[item]--;
  }
});

/* ================= TAG / NACHT ================= */
let time=0;
function updateTime(){ time+=0.001; if(time>1) time=0; }

/* ================= MONSTER ================= */
function spawnMonsters(){
  if(time>0.5 && Math.random()<0.02){
    monsters.push({x:player.x+600,y:0,w:30,h:30,vy:0,onGround:false});
  }
}
function updateMonsters(){
  monsters.forEach(m=>{
    m.x+=(player.x>m.x?1:-1)*1.2;
    applyPhysics(m);
    if(player.x<m.x+m.w&&player.x+player.w>m.x&&
       player.y<m.y+m.h&&player.y+player.h>m.y){
      player.hp--;
    }
  });
}

/* ================= TIERE ================= */
function spawnAnimals(){
  if(Math.random()<0.01){
    animals.push({x:player.x+400,y:0,w:30,h:30,vy:0,onGround:false});
  }
}
function updateAnimals(){
  animals.forEach(a=>{
    if(Math.random()<0.02) a.x+=Math.random()<0.5?-1:1;
    applyPhysics(a);
  });
}

/* ================= UI ================= */
function drawHearts(){
  for(let i=0;i<player.hp;i++){
    ctx.fillStyle="red";
    ctx.fillRect(10+i*15,10,12,12);
  }
}
function drawHunger(){
  for(let i=0;i<player.hunger;i++){
    ctx.fillStyle="orange";
    ctx.fillRect(10+i*15,30,12,12);
  }
}

/* ================= ZEICHNEN ================= */
function draw(){
  ctx.fillStyle=`rgb(${135*(1-time)},${206*(1-time)},${235*(1-time)})`;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let x=0;x<world.length;x++){
    for(let y=0;y<ROWS;y++){
      const b=world[x][y];
      if(!b) continue;
      const colors={1:"#654321",2:"#888",3:"#deb887",4:"#b5651d",5:"#aaa",6:"#ffd700",7:"#0dd"};
      ctx.fillStyle=colors[b];
      ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE);
    }
  }

  ctx.fillStyle="red";
  ctx.fillRect(player.x-cameraX,player.y,player.w,player.h);

  ctx.fillStyle="green";
  monsters.forEach(m=>ctx.fillRect(m.x-cameraX,m.y,m.w,m.h));

  ctx.fillStyle="brown";
  animals.forEach(a=>ctx.fillRect(a.x-cameraX,a.y,a.w,a.h));

  drawHearts();
  drawHunger();
}

/* ================= LOOP ================= */
function loop(){
  updateTime();
  extendWorld();
  updatePlayer();
  spawnMonsters();
  spawnAnimals();
  updateMonsters();
  updateAnimals();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
