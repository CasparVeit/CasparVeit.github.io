<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini Minecraft 2D Full</title>
<style>
body { margin:0; background:#87ceeb; }
canvas { display:block; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 400;

const TILE = 40;
const ROWS = 10;
let world = [];
let COLS = 100; // initial
const generateColumn = (colIndex) => {
  let col = [];
  for (let y = 0; y < ROWS; y++) {
    if (y < 5) col.push(0); // Luft
    else if (y === 5) col.push(1); // Gras
    else {
      let r = Math.random();
      if(r<0.02) col.push(7); // Diamant
      else if(r<0.07) col.push(6); // Gold
      else if(r<0.2) col.push(5); // Eisen
      else col.push(2); // Stein
    }
  }
  // Bäume
  if(Math.random()<0.1){
    col[4]=3; col[3]=3; col[2]=3; // Holzstamm
  }
  // Wasser
  if(Math.random()<0.03) col[5]=8;
  return col;
}
// initiale Welt
for(let x=0;x<COLS;x++) world.push(generateColumn(x));

let player = {x:100,y:100,w:30,h:30,hp:5,tool:null};
let monsters = [];
let inventory = {dirt:0,stone:0,wood:0,table:0,sword:0,pickaxe:0,iron:0,gold:0,diamond:0,water:0};
let keys = {};
document.addEventListener("keydown", e=>keys[e.key]=true);
document.addEventListener("keyup", e=>keys[e.key]=false);

// Abbauen/Platzieren
canvas.addEventListener("click", e=>{
  const x = Math.floor((e.offsetX+cameraX)/TILE);
  const y = Math.floor(e.offsetY/TILE);
  const block = world[x][y];
  if(block>0){
    if(block===1) inventory.dirt++;
    if(block===2) inventory.stone++;
    if(block===3) inventory.wood++;
    if(block===5) inventory.iron++;
    if(block===6) inventory.gold++;
    if(block===7) inventory.diamond++;
    if(block===8) inventory.water++;
    world[x][y]=0;
  } else {
    if(inventory.dirt>0){ world[x][y]=1; inventory.dirt--; }
    else if(inventory.stone>0){ world[x][y]=2; inventory.stone--; }
    else if(inventory.wood>0){ world[x][y]=3; inventory.wood--; }
  }
});

// Crafting
document.addEventListener("keydown", e=>{
  if(e.key==="c"){
    if(inventory.wood>=4){ inventory.wood-=4; inventory.table++; }
    if(inventory.wood>=2 && inventory.stone>=1 && inventory.table>=1){ inventory.wood-=2; inventory.stone-=1; inventory.sword++; player.tool="sword"; }
    if(inventory.wood>=2 && inventory.stone>=2 && inventory.table>=1){ inventory.wood-=2; inventory.stone-=2; inventory.pickaxe++; player.tool="pickaxe"; }
  }
});

// Werkbank setzen
document.addEventListener("keydown", e=>{
  if(e.key==="t" && inventory.table>0){
    const x=Math.floor(player.x/TILE);
    const y=Math.floor(player.y/TILE);
    world[x][y]=4; inventory.table--;
  }
});

// Tag/Nacht
let time=0; //0-1
function updateTime(){ time+=0.001; if(time>1)time=0; }

// Kamera
let cameraX=0;
function updateCamera(){ cameraX = player.x - canvas.width/2; if(cameraX<0) cameraX=0; }

// Spieler bewegen
function updatePlayer(){
  if(keys["a"]) player.x-=4;
  if(keys["d"]) player.x+=4;
  if(keys["w"]) player.y-=4;
  if(keys["s"]) player.y+=4;
  player.x=Math.max(0,player.x);
  player.y=Math.max(0,Math.min(player.y,canvas.height-player.h));
}

// Monster spawn nachts
function spawnMonsters(){
  if(time>0.5 && Math.random()<0.01 && monsters.length<10){
    monsters.push({x:cameraX+canvas.width+Math.random()*200,y:300,w:30,h:30,dir:-1,speed:1.5});
  }
}

// Monster KI
function updateMonsters(){
  monsters.forEach(mon=>{
    const dx = player.x-mon.x;
    const dy = player.y-mon.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(dist<200){ mon.x += dx/dist*mon.speed; mon.y += dy/dist*mon.speed; }
    else{ mon.x += mon.dir*mon.speed; }
    if(player.x<mon.x+mon.w && player.x+player.w>mon.x && player.y<mon.y+mon.h && player.y+player.h>mon.y){
      if(player.tool==="sword"){ monsters.splice(monsters.indexOf(mon),1); }
      else{ player.hp--; if(player.hp<=0){ alert("Du bist gestorben!"); location.reload(); } }
    }
  });
}

// Unendliche Welt erweitern
function extendWorld(){
  const lastCol = world.length;
  for(let i=0;i<5;i++){
    world.push(generateColumn(lastCol+i));
  }
}

// Zeichnen
function drawWorld(){
  const bg = `rgba(${135*(1-time)},${206*(1-time)},${235*(1-time)},1)`;
  ctx.fillStyle=bg; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let x=0;x<world.length;x++){
    for(let y=0;y<ROWS;y++){
      const b=world[x][y];
      if(b===1){ ctx.fillStyle="#654321"; ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE); }
      if(b===2){ ctx.fillStyle="#888888"; ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE); }
      if(b===3){ ctx.fillStyle="#deb887"; ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE); }
      if(b===4){ ctx.fillStyle="#b5651d"; ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE); }
      if(b===5){ ctx.fillStyle="#b0b0b0"; ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE); }
      if(b===6){ ctx.fillStyle="#ffd700"; ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE); }
      if(b===7){ ctx.fillStyle="#0dd"; ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE); }
      if(b===8){ ctx.fillStyle="#00f"; ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE); }
    }
  }
}

function drawPlayer(){ ctx.fillStyle="red"; ctx.fillRect(player.x-cameraX,player.y,player.w,player.h); }
function drawMonsters(){ monsters.forEach(mon=>{ ctx.fillStyle="green"; ctx.fillRect(mon.x-cameraX,mon.y,mon.w,mon.h); }); }
function drawUI(){
  ctx.fillStyle="black";
  ctx.fillText("HP: "+player.hp,10,20);
  ctx.fillText("Blöcke: Erde "+inventory.dirt+", Stein "+inventory.stone+", Holz "+inventory.wood+", Eisen "+inventory.iron+", Gold "+inventory.gold+", Diamant "+inventory.diamond,10,40);
  ctx.fillText("Werkbank: "+inventory.table+", Schwert: "+inventory.sword+", Spitzhacke: "+inventory.pickaxe,10,60);
  ctx.fillText("C=Craft, T=Werkbank setzen, Maus=Block",10,80);
  ctx.fillText("Tag/Nacht: "+Math.floor(time*24)+":00",10,100);
}

// Loop
function loop(){
  updateTime();
  extendWorld();
  updatePlayer();
  updateCamera();
  spawnMonsters();
  updateMonsters();
  drawWorld();
  drawPlayer();
  drawMonsters();
  drawUI();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
