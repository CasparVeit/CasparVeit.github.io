<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini Minecraft 2D Extended</title>
<style>
  body { margin:0; background:#87ceeb; }
  canvas { display:block; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 400;

const TILE = 40;

// Blöcke: 0=Luft,1=Erde,2=Holz,3=Stein,4=Werkbank
let world = [
 [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
 [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
 [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
 [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
 [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
];

// Spieler
const player = { x:100, y:100, w:30, h:30, hp:5, tool:null };

// Monster
let monsters = [
 { x:500, y:100, w:30, h:30, dir:1, speed:1.5 },
 { x:700, y:150, w:30, h:30, dir:-1, speed:2 }
];

// Inventar
let inventory = { dirt:0, wood:0, stone:0, table:0, sword:0, pickaxe:0 };

// Tasten
const keys = {};
document.addEventListener("keydown", e=>keys[e.key]=true);
document.addEventListener("keyup", e=>keys[e.key]=false);

// Abbauen / Platzieren
canvas.addEventListener("click", e=>{
  const x = Math.floor(e.offsetX / TILE);
  const y = Math.floor(e.offsetY / TILE);
  const block = world[y][x];
  if(block>0 && block<4){ // abbauen
    if(block===1) inventory.dirt++;
    if(block===2) inventory.wood++;
    if(block===3) inventory.stone++;
    world[y][x]=0;
  } else if(block===0){ // platzieren (aus Inventar)
    if(inventory.dirt>0){ world[y][x]=1; inventory.dirt--; }
    else if(inventory.wood>0){ world[y][x]=2; inventory.wood--; }
    else if(inventory.stone>0){ world[y][x]=3; inventory.stone--; }
  }
});

// Crafting Rezepte
document.addEventListener("keydown", e=>{
  if(e.key==="c"){ 
    // Werkbank: 4 Holz
    if(inventory.wood>=4){ inventory.wood-=4; inventory.table++; }
    // Schwert: 2 Holz + 1 Stein + 1 Werkbank
    if(inventory.wood>=2 && inventory.stone>=1 && inventory.table>=1){ inventory.wood-=2; inventory.stone-=1; player.tool="sword"; inventory.sword++; }
    // Spitzhacke: 2 Holz + 2 Stein + 1 Werkbank
    if(inventory.wood>=2 && inventory.stone>=2 && inventory.table>=1){ inventory.wood-=2; inventory.stone-=2; player.tool="pickaxe"; inventory.pickaxe++; }
  }
});

// Werkbank setzen
document.addEventListener("keydown", e=>{
  if(e.key==="t" && inventory.table>0){
    const x = Math.floor(player.x/TILE);
    const y = Math.floor(player.y/TILE);
    world[y][x]=4;
    inventory.table--;
  }
});

// Tag/Nacht
let time=0; //0-1
function updateTime(){ time+=0.001; if(time>1)time=0; }

// Spieler bewegen
function updatePlayer(){
  if(keys["a"]) player.x-=4;
  if(keys["d"]) player.x+=4;
  if(keys["w"]) player.y-=4;
  if(keys["s"]) player.y+=4;
  player.x = Math.max(0, Math.min(player.x, canvas.width-player.w));
  player.y = Math.max(0, Math.min(player.y, canvas.height-player.h));
}

// Monster KI
function updateMonsters(){
  monsters.forEach(mon=>{
    const dx = player.x - mon.x;
    const dy = player.y - mon.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(dist<200){ // folgt Spieler
      mon.x += dx/dist*mon.speed;
      mon.y += dy/dist*mon.speed;
    } else {
      mon.x += mon.dir*mon.speed;
      if(mon.x<0 || mon.x>canvas.width-30) mon.dir*=-1;
    }
    // Spieler treffen
    if(player.x<mon.x+mon.w && player.x+player.w>mon.x &&
       player.y<mon.y+mon.h && player.y+player.h>mon.y){
      if(player.tool==="sword"){ // Monster besiegen
        const index = monsters.indexOf(mon);
        if(index>-1) monsters.splice(index,1);
      } else { // Spieler verliert Leben
        player.hp--;
        if(player.hp<=0){ alert("Du bist gestorben!"); location.reload(); }
      }
    }
  });
}

// Zeichnen
function drawWorld(){
  // Hintergrund Tag/Nacht
  const bg = `rgba(${135*(1-time)},${206*(1-time)},${235*(1-time)},1)`;
  ctx.fillStyle=bg; ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let y=0;y<world.length;y++){
    for(let x=0;x<world[y].length;x++){
      const b = world[y][x];
      if(b===1){ ctx.fillStyle="#654321"; ctx.fillRect(x*TILE,y*TILE,TILE,TILE); }
      if(b===2){ ctx.fillStyle="#deb887"; ctx.fillRect(x*TILE,y*TILE,TILE,TILE); }
      if(b===3){ ctx.fillStyle="#888888"; ctx.fillRect(x*TILE,y*TILE,TILE,TILE); }
      if(b===4){ ctx.fillStyle="#b5651d"; ctx.fillRect(x*TILE,y*TILE,TILE,TILE); }
    }
  }
}

function drawPlayer(){ ctx.fillStyle="red"; ctx.fillRect(player.x,player.y,player.w,player.h); }
function drawMonsters(){ monsters.forEach(mon=>{ ctx.fillStyle="green"; ctx.fillRect(mon.x,mon.y,mon.w,mon.h); }); }

function drawUI(){
  ctx.fillStyle="black";
  ctx.fillText("HP: "+player.hp,10,20);
  ctx.fillText("Werkzeuge:",10,40);
  ctx.fillText("Schwert: "+inventory.sword,10,60);
  ctx.fillText("Spitzhacke: "+inventory.pickaxe,10,80);
  ctx.fillText("Blöcke: Erde "+inventory.dirt+", Holz "+inventory.wood+", Stein "+inventory.stone,10,100);
  ctx.fillText("Werkbank: "+inventory.table,10,120);
  ctx.fillText("C=craften, T=Werkbank setzen, Maus=Block",10,140);
}

// Speicherstand
function saveGame(){ localStorage.setItem("mcSave",JSON.stringify({player,inventory,world,monsters})); }
function loadGame(){
  const save = localStorage.getItem("mcSave");
  if(save){
    const data = JSON.parse(save);
    Object.assign(player,data.player);
    Object.assign(inventory,data.inventory);
    world=data.world;
    monsters=data.monsters;
  }
}
document.addEventListener("keydown", e=>{ if(e.key==="p") saveGame(); if(e.key==="l") loadGame(); });

// Loop
function loop(){
  updateTime();
  updatePlayer();
  updateMonsters();
  drawWorld();
  drawPlayer();
  drawMonsters();
  drawUI();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
